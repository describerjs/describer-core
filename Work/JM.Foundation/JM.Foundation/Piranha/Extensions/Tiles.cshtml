@using System.Web.Mvc.Html
@using JM.Foundation.Mvc.Helper
@using Piranha.Extend.Regions
@model Tiles
@{
	string regionID = "0";
	string fieldString = "";

	var i = 0;
	fieldString = @Html.GetFullHtmlFieldName(m => m.Elements.FirstOrDefault().Content);
	regionID = fieldString.Replace("Regions[", "").Split(']')[0].Replace(".", "");
}

<span id="@String.Format("tileformupdate{0}", regionID)">
<script>
	// Floatpanels für Editoren wieder entfernen
	$(document).ready(function() {
		if(tinyMCE.editors.length > 1){
			$(window).unbind('scroll');
		}

		$("body").on("click", "#@String.Format("addtile{0}", regionID)", function () {
			var serializedData = $('form').serialize();
			jQuery.ajax({
				url: '/PiranhaModel/AddTile',
				type: 'POST',
				data: serializedData + "&regionID=@regionID",
				beforeSend: function () {
					//addSpinnerToBody();
				},
				success: function (data) {
					$("#@String.Format("tileformupdate{0}", regionID)").replaceWith(data);
					addEditors();
					//removeSpinnerToBody();
				},
				error: function () {
					//removeSpinnerToBody();
					$("#@String.Format("tileformupdate{0}", regionID)").html("<p>Leider ist ein Fehler aufgereten, versuchen Sie es später erneut.</p>");
				}
			});
		});
	});
	function addEditors() {
		tinymce.init({ selector: 'textarea' });
	}
</script>
<ul class="form" id="@String.Format("tileform{0}", regionID)">
	@foreach(var tile in Model.Elements)
	{
		<li><p>Kachel @(i + 1)</p></li>
		@Html.EditorFor(m => Model.Elements[i], "TileEditor");
		i++;
	}
	<li>
		<label>Kachel hinzufügen</label>
		<div class="input"><a class="btn" id="@String.Format("addtile{0}", regionID)">+</a></div>
	</li>
	<li>
		@Html.LabelFor(m => m.Tiling, "Kachelung")
		<div class="input">@Html.DropDownListFor(m => m.Tiling, Model.TilingSelection)</div>
	</li>
	<li>
		@Html.LabelFor(m => m.Hide, "Verstecken")
		<div class="input">@Html.CheckBoxFor(m => m.Hide)</div>
		<p>Blendet das aktuelle Element vollständig aus</p>
	</li>
</ul>
</span>